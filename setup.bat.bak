@echo off
REM SwanStudios Setup Script for Windows
REM This script will help you set up the entire project from scratch

echo === SwanStudios Setup Script ===
echo.

REM Step 1: Check if .env file exists
echo Checking environment configuration...
if not exist ".env" (
    echo No .env file found. Creating from example...
    if exist ".env.example" (
        copy ".env.example" ".env" >nul
        echo Created .env file from example. Please edit with your actual configuration values.
    ) else (
        echo Error: .env.example file not found! Please create a .env file manually.
        exit /b 1
    )
) else (
    echo Found .env file.
)

REM Step 2: Install dependencies
echo.
echo Installing dependencies...
call npm install
if %ERRORLEVEL% neq 0 (
    echo Error: Failed to install root dependencies. Please check npm logs.
    exit /b 1
)

REM Install frontend dependencies
echo.
echo Installing frontend dependencies...
cd frontend
call npm install
if %ERRORLEVEL% neq 0 (
    echo Error: Failed to install frontend dependencies. Please check npm logs.
    cd ..
    exit /b 1
)
cd ..

REM Install backend dependencies
echo.
echo Installing backend dependencies...
cd backend
call npm install
if %ERRORLEVEL% neq 0 (
    echo Error: Failed to install backend dependencies. Please check npm logs.
    cd ..
    exit /b 1
)

REM Step 3: Reset database and run migrations/seeders
echo.
echo Setting up database...
call npm run db:reset-manual
if %ERRORLEVEL% neq 0 (
    echo Error: Database setup failed. Please check the error messages above.
    echo You may need to create the database manually.
    cd ..
    exit /b 1
)
cd ..

echo.
echo === Setup completed successfully! ===
echo You can now start the application with:
echo npm run start
echo.
echo Admin login credentials:
echo Username: admin
echo Password: 55555
echo.

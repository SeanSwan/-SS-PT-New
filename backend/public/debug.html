<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwanStudios Full Debug Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Custom Styling (Combined & Corrected) -->
    <style>
        :root {
            --bs-primary: #4e73df; --bs-success: #1cc88a; --bs-info: #36b9cc;
            --bs-warning: #f6c23e; --bs-danger: #e74a3b; --bs-light: #f8f9fc;
            --bs-secondary: #858796; --bs-dark: #5a5c69;
        }
        body { display: flex; min-height: 100vh; background-color: var(--bs-light); font-size: 0.9rem; }
        #sidebar { width: 250px; background-color: #4e73df; background-image: linear-gradient(180deg, #4e73df 10%, #224abe 100%); flex-shrink: 0; display: flex; flex-direction: column; transition: margin-left 0.3s ease-in-out; overflow-y: auto; }
        #sidebar .nav-link { color: rgba(255, 255, 255, 0.8); padding: 0.75rem 1rem; font-weight: 500; font-size: 0.9rem; border-radius: 0; }
        #sidebar .nav-link:hover, #sidebar .nav-link.active { color: white; background-color: rgba(255, 255, 255, 0.1); }
        #sidebar .nav-link i { margin-right: 0.6rem; width: 20px; text-align: center; font-size: 1.1em; }
        #sidebar hr.sidebar-divider { border-top: 1px solid rgba(255, 255, 255, 0.15); margin: 1rem 0; }
        #content-wrapper { flex-grow: 1; display: flex; flex-direction: column; overflow-x: hidden; }
        #main-content { flex-grow: 1; padding: 25px; }
        .topbar { height: 70px; background-color: #fff; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important; margin-bottom: 1.5rem; padding: 0 1.5rem; display: flex; align-items: center; justify-content: space-between; }
        .card { box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1) !important; border: 1px solid #e3e6f0; margin-bottom: 1.5rem; }
        .card-header { background-color: #f8f9fc; border-bottom: 1px solid #e3e6f0; font-weight: 700; color: var(--bs-primary); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; }
        .card-header h5, .card-header h6 { margin-bottom: 0; }
        .result { background-color: #e9ecef; border: 1px solid #d1d3e2; border-radius: 0.25rem; padding: 1rem; margin-top: 10px; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; word-break: break-all; max-height: 350px; overflow-y: auto; }
        .form-label { font-weight: bold; margin-bottom: 0.3rem; font-size: 0.9rem; }
        .form-control, .form-select { font-size: 0.9rem; padding: 0.5rem 0.75rem; }
        .small-text { font-size: 0.8rem; color: #858796; }
        .status-ok { border-left: 5px solid var(--bs-success); padding-left: 10px; }
        .status-error { border-left: 5px solid var(--bs-danger); padding-left: 10px; }
        .btn { font-size: 0.85rem; padding: 0.375rem 0.75rem; }
        .btn-sm { font-size: 0.75rem; padding: 0.25rem 0.5rem; }
        .connection-status { display: flex; align-items: center; margin-bottom: 5px; font-size: 0.8rem; color: rgba(255, 255, 255, 0.8); }
        .connection-badge { display: inline-block; padding: 0.2rem 0.4rem; border-radius: 0.25rem; margin-left: 0.5rem; font-size: 0.7rem; font-weight: 600; }
        .connection-badge.connected { background-color: var(--bs-success); color: white; }
        .connection-badge.disconnected { background-color: var(--bs-danger); color: white; }
        .connection-badge.unknown { background-color: var(--bs-secondary); color: white; }
        .environment-info { font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); }
        #sidebarToggle { position: fixed; bottom: 15px; left: 265px; z-index: 1050; width: 40px; height: 40px; border-radius: 50%; background-color: var(--bs-primary); color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.2); cursor: pointer; transition: all 0.3s; }
        body.sidebar-toggled #sidebar { margin-left: -250px; }
        body.sidebar-toggled #content-wrapper { margin-left: 0; }
        body.sidebar-toggled #sidebarToggle { left: 15px; }
        .api-endpoint { cursor: pointer; padding: 5px; border-radius: 3px; margin-bottom: 3px; font-size: 0.85rem; }
        .api-endpoint:hover { background-color: #eef; }
        .api-tag { font-size: 0.7em; padding: 2px 5px; border-radius: 3px; margin-right: 5px; color: white; font-weight: bold; vertical-align: middle; }
        .api-tag.get { background-color: var(--bs-info); }
        .api-tag.post { background-color: var(--bs-success); }
        .api-tag.put { background-color: var(--bs-warning); color: #333 !important; }
        .api-tag.delete { background-color: var(--bs-danger); }
        .nav-pills .nav-link.active, .nav-pills .show > .nav-link { color: white !important; background-color: rgba(255, 255, 255, 0.2) !important; }
        .toast-container { z-index: 2000; }
        .table-responsive { max-height: 400px; } /* Limit table height */
    </style>
</head>
<body id="page-top">
    <div id="wrapper" class="d-flex">

        <!-- Sidebar -->
        <div id="sidebar" class="d-flex flex-column">
            <div class="p-3 mt-2 text-center">
                <h4 class="text-white fw-bold">SwanStudios</h4>
                <p class="text-white-50 small">Debug Dashboard</p>
            </div>
            <hr class="sidebar-divider my-0">
            <ul class="nav nav-pills flex-column mb-auto" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <li class="nav-item" role="presentation"><a class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="true"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-auth-tab" data-bs-toggle="pill" href="#auth-test" role="tab" aria-controls="auth-test" aria-selected="false"><i class="bi bi-shield-lock"></i> Authentication</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-store-tab" data-bs-toggle="pill" href="#store" role="tab" aria-controls="store" aria-selected="false"><i class="bi bi-shop"></i> Store & Cart</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-checkout-tab" data-bs-toggle="pill" href="#checkout" role="tab" aria-controls="checkout" aria-selected="false"><i class="bi bi-credit-card"></i> Checkout</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-sessions-tab" data-bs-toggle="pill" href="#sessions" role="tab" aria-controls="sessions" aria-selected="false"><i class="bi bi-calendar-check"></i> Sessions</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-users-tab" data-bs-toggle="pill" href="#users" role="tab" aria-controls="users" aria-selected="false"><i class="bi bi-people"></i> Users (Debug)</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-database-tab" data-bs-toggle="pill" href="#database" role="tab" aria-controls="database" aria-selected="false"><i class="bi bi-database"></i> Database (Debug)</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-api-explorer-tab" data-bs-toggle="pill" href="#api-explorer" role="tab" aria-controls="api-explorer" aria-selected="false"><i class="bi bi-terminal"></i> API Explorer</a></li>
                <!-- Add Logs Tab Link if implementing log fetching -->
                <!-- <li class="nav-item" role="presentation"><a class="nav-link" id="v-pills-logs-tab" data-bs-toggle="pill" href="#logs" role="tab" aria-controls="logs" aria-selected="false"><i class="bi bi-journal-text"></i> Logs</a></li> -->
            </ul>
            <hr class="sidebar-divider mt-auto">
            <div class="p-3">
                <div class="connection-status"><span>Database:</span> <span id="database-status" class="connection-badge unknown">Checking...</span></div>
                <div class="connection-status"><span>Server:</span> <span id="server-status" class="connection-badge connected">Online</span></div>
                <div class="environment-info mt-2">Env: <span id="environment-value">--</span> | Node: <span id="version-value">--</span></div>
            </div>
        </div><!-- /#sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="main-content">
                <!-- Topbar -->
                 <nav class="topbar">
                     <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" onclick="toggleSidebar()"><i class="bi bi-list fs-4"></i></button>
                     <span class="navbar-brand mb-0 h1 d-none d-sm-block">API Debug Dashboard</span>
                     <div class="d-flex align-items-center">
                        <span id="current-time" class="me-3 text-secondary small">--:--:--</span>
                        <button class="btn btn-outline-secondary btn-sm" onclick="checkSystemStatus()"><i class="bi bi-arrow-clockwise"></i> Refresh Status</button>
                     </div>
                </nav>
                <!-- /Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <div class="tab-content" id="v-pills-tabContent">

                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="v-pills-dashboard-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Dashboard</h1> </div>
                            <div class="row">
                                <!-- Status Cards -->
                                <div class="col-xl-3 col-md-6 mb-4"> <div class="card border-start border-primary border-4 h-100"><div class="card-body"><div class="row align-items-center"><div class="col mr-2"><div class="text-xs fw-bold text-primary text-uppercase mb-1">Server Uptime</div><div class="h5 mb-0 fw-bold text-gray-800" id="server-uptime">--</div></div><div class="col-auto"><i class="bi bi-server fs-2 text-gray-300"></i></div></div></div></div></div>
                                <div class="col-xl-3 col-md-6 mb-4"> <div class="card border-start border-success border-4 h-100"><div class="card-body"><div class="row align-items-center"><div class="col mr-2"><div class="text-xs fw-bold text-success text-uppercase mb-1">Database Status</div><div class="h5 mb-0 fw-bold text-gray-800" id="db-status-card">--</div></div><div class="col-auto"><i class="bi bi-database fs-2 text-gray-300"></i></div></div></div></div></div>
                                <div class="col-xl-3 col-md-6 mb-4"> <div class="card border-start border-info border-4 h-100"><div class="card-body"><div class="row align-items-center"><div class="col mr-2"><div class="text-xs fw-bold text-info text-uppercase mb-1">Memory Usage</div><div class="h5 mb-0 fw-bold text-gray-800" id="memory-usage">--</div></div><div class="col-auto"><i class="bi bi-memory fs-2 text-gray-300"></i></div></div></div></div></div>
                                <div class="col-xl-3 col-md-6 mb-4"> <div class="card border-start border-warning border-4 h-100"><div class="card-body"><div class="row align-items-center"><div class="col mr-2"><div class="text-xs fw-bold text-warning text-uppercase mb-1">Environment</div><div class="h5 mb-0 fw-bold text-gray-800" id="environment-value-card">--</div></div><div class="col-auto"><i class="bi bi-gear fs-2 text-gray-300"></i></div></div></div></div></div>
                            </div>
                             <div class="card shadow mb-4">
                                <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Quick Actions / System Check</h6></div>
                                <div class="card-body">
                                    <div class="mb-3 d-flex flex-wrap">
                                        <button class="btn btn-primary m-1 flex-fill" onclick="navigateToTab('auth-test')"><i class="bi bi-shield-lock"></i> Test Auth</button>
                                        <button class="btn btn-success m-1 flex-fill" onclick="navigateToTab('store')"><i class="bi bi-shop"></i> Test Store/Cart</button>
                                        <button class="btn btn-info m-1 flex-fill" onclick="navigateToTab('sessions')"><i class="bi bi-calendar-check"></i> Test Sessions</button>
                                        <button class="btn btn-warning m-1 flex-fill" onclick="makeRequest('/api/debug/create-test-user', 'GET', null, 'system-activity-result')"><i class="bi bi-person-plus"></i> Create Test User</button>
                                        <button class="btn btn-secondary m-1 flex-fill" onclick="navigateToTab('api-explorer')"><i class="bi bi-terminal"></i> API Explorer</button>
                                    </div>
                                    <button class="btn btn-outline-primary w-100" onclick="runSystemCheck()"><i class="bi bi-check-circle"></i> Run Full System Check</button>
                                    <div id="diagnostics-results" class="result mt-3">System check results appear here...</div>
                                    <div id="system-activity-result" class="result mt-3">Action results appear here...</div>
                                </div>
                            </div>
                        </div><!-- /#dashboard -->

                        <!-- Authentication Tab -->
                        <div class="tab-pane fade" id="auth-test" role="tabpanel" aria-labelledby="v-pills-auth-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Authentication</h1> </div>
                            <div class="row">
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Login (Live API: /api/auth/login)</h6></div><div class="card-body"><label for="login-username" class="form-label">Username:</label><input type="text" id="login-username" class="form-control mb-2" placeholder="Username"><label for="login-password" class="form-label">Password:</label><input type="password" id="login-password" class="form-control mb-2" placeholder="Password"><button class="btn btn-primary w-100" onclick="testLogin()"><i class="bi bi-box-arrow-in-right"></i> Test Live Login</button><div id="login-result" class="result mt-3">Login results...</div></div></div></div>
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Registration (Live API: /api/auth/register)</h6></div><div class="card-body"><label for="reg-username" class="form-label">Username:</label><input type="text" id="reg-username" class="form-control mb-1" placeholder="New Unique Username"><label for="reg-email" class="form-label">Email:</label><input type="email" id="reg-email" class="form-control mb-1" placeholder="New Unique Email"><label for="reg-password" class="form-label">Password:</label><input type="password" id="reg-password" class="form-control mb-1" placeholder="Password"><label for="reg-firstName" class="form-label">First Name:</label><input type="text" id="reg-firstName" class="form-control mb-1" placeholder="First Name"><label for="reg-lastName" class="form-label">Last Name:</label><input type="text" id="reg-lastName" class="form-control mb-2" placeholder="Last Name"><button class="btn btn-success w-100" onclick="testRegistration()"><i class="bi bi-person-plus"></i> Test Live Registration</button><div id="registration-result" class="result mt-3">Registration results...</div></div></div></div>
                            </div>
                        </div><!-- /#auth-test -->

                        <!-- Store & Cart Tab -->
                        <div class="tab-pane fade" id="store" role="tabpanel" aria-labelledby="v-pills-store-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Store & Cart</h1> </div>
                            <div class="row">
                                <div class="col-lg-5 mb-4">
                                    <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Storefront Items</h6></div><div class="card-body"><button class="btn btn-primary w-100" onclick="makeRequest('/api/storefront/items', 'GET', null, 'storefront-result')"><i class="bi bi-list-ul"></i> List Store Items</button><div id="storefront-result" class="result mt-3">Storefront results... (Note Item IDs)</div></div></div>
                                </div>
                                <div class="col-lg-7 mb-4">
                                    <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Shopping Cart Operations</h6></div><div class="card-body">
                                        <label for="cart-user-id" class="form-label">User ID (for ALL Cart Ops):</label>
                                        <input type="number" id="cart-user-id" class="form-control mb-2" placeholder="Enter User ID (e.g., 1)">
                                        <button class="btn btn-primary w-100 mb-3" onclick="viewCart()"><i class="bi bi-cart3"></i> View User's Cart</button>
                                        <div id="view-cart-result" class="result">View cart results... (Note CartItem IDs needed below)</div>
                                        <hr><label class="form-label mt-2">Add/Update/Remove Item:</label>
                                        <div class="input-group mb-2"><span class="input-group-text" style="width: 100px;">Item ID</span><input type="number" id="cart-item-id" placeholder="Storefront Item ID" class="form-control"><span class="input-group-text">Qty</span><input type="number" id="cart-quantity" value="1" min="1" class="form-control" style="max-width: 70px;"><button class="btn btn-success" onclick="addToCart()">Add</button></div>
                                        <div class="input-group mb-2"><span class="input-group-text" style="width: 100px;">CartItemID</span><input type="number" id="cart-item-update-id" placeholder="From View Cart" class="form-control"><span class="input-group-text">New Qty</span><input type="number" id="cart-update-quantity" value="1" min="0" class="form-control" style="max-width: 70px;"><button class="btn btn-warning" onclick="updateCartItem()">Update</button><button class="btn btn-danger" onclick="removeFromCart()">Remove</button></div>
                                        <div id="cart-op-result" class="result mt-3">Cart operation results...</div>
                                    </div></div>
                                </div>
                            </div>
                        </div><!-- /#store -->

                         <!-- Checkout Tab -->
                        <div class="tab-pane fade" id="checkout" role="tabpanel" aria-labelledby="v-pills-checkout-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Checkout</h1> </div>
                            <div class="card shadow">
                                <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Initiate Checkout</h6></div>
                                <div class="card-body">
                                    <label for="checkout-user-id" class="form-label">User ID (with items in cart):</label>
                                    <input type="number" id="checkout-user-id" class="form-control mb-2" placeholder="Enter User ID">
                                    <button class="btn btn-success w-100" onclick="startCheckout()"><i class="bi bi-credit-card-fill"></i> Initiate Stripe Checkout</button>
                                    <p class="small-text mt-1">Tests backend creation of Stripe Checkout session. Response should include a URL.</p>
                                    <div id="checkout-result" class="result mt-3">Checkout results...</div>
                                </div>
                            </div>
                        </div><!-- /#checkout -->

                        <!-- Sessions Tab -->
                        <div class="tab-pane fade" id="sessions" role="tabpanel" aria-labelledby="v-pills-sessions-tab">
                            <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Sessions & Schedule</h1> </div>
                            <div class="row">
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">View Schedule</h6></div><div class="card-body"><label for="schedule-user-id" class="form-label">User ID (Client or Trainer):</label><input type="number" id="schedule-user-id" class="form-control mb-2" placeholder="Enter User ID"><button class="btn btn-primary w-100" onclick="viewSchedule()"><i class="bi bi-calendar-week"></i> View User Schedule</button></div></div></div>
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">View Session Details</h6></div><div class="card-body"><label for="session-id" class="form-label">Session ID:</label><input type="number" id="session-id" class="form-control mb-2" placeholder="Enter Session ID from schedule"><button class="btn btn-info w-100" onclick="viewSessionDetails()"><i class="bi bi-info-circle"></i> View Session Details</button></div></div></div>
                            </div>
                            <div class="card mt-3 shadow">
                                <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Session/Schedule Results</h6></div>
                                <div class="card-body"><div id="session-result" class="result">Results...</div></div>
                            </div>
                             <!-- Add forms/buttons for Create/Update/Delete Sessions if needed -->
                        </div><!-- /#sessions -->

                         <!-- Users (Debug) Tab -->
                        <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="v-pills-users-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">User Debug</h1> </div>
                            <div class="row">
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Check User Existence (Debug)</h6></div><div class="card-body"><label for="check-identifier-debug" class="form-label">Username or Email:</label><input type="text" id="check-identifier-debug" class="form-control mb-2" placeholder="ogpswan or user@example.com"><button class="btn btn-info w-100" onclick="checkUserDebug()"><i class="bi bi-search"></i> Check Existence</button><div id="check-user-result-debug" class="result mt-3">Results...</div></div></div></div>
                                <div class="col-lg-6 mb-4"> <div class="card shadow h-100"><div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Verify Password (Debug)</h6></div><div class="card-body"><label for="verify-username-debug" class="form-label">Username:</label><input type="text" id="verify-username-debug" class="form-control mb-2" placeholder="Username"><label for="verify-password-debug" class="form-label">Password:</label><input type="password" id="verify-password-debug" class="form-control mb-2" placeholder="Password"><button class="btn btn-warning w-100" onclick="verifyPasswordDebug()"><i class="bi bi-check2-circle"></i> Verify Password</button><div id="verify-password-result-debug" class="result mt-3">Results...</div></div></div></div>
                            </div>
                        </div><!-- /#users -->

                         <!-- Database (Debug) Tab -->
                        <div class="tab-pane fade" id="database" role="tabpanel" aria-labelledby="v-pills-database-tab">
                            <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">Database Debug</h1> </div>
                             <div class="card shadow">
                                <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">DB Connection & Info</h6></div>
                                <div class="card-body">
                                    <button class="btn btn-info me-2" onclick="makeRequest('/api/debug/check-db', 'GET', null, 'db-info-result')"><i class="bi bi-database-check"></i> Test DB Connection</button>
                                    <div id="db-info-result" class="result mt-3">DB Info results...</div>
                                </div>
                            </div>
                        </div><!-- /#database -->

                        <!-- API Explorer Tab -->
                        <div class="tab-pane fade" id="api-explorer" role="tabpanel" aria-labelledby="v-pills-api-explorer-tab">
                           <div class="d-sm-flex align-items-center justify-content-between mb-4"> <h1 class="h3 mb-0 text-gray-800">API Explorer</h1> </div>
                             <div class="card shadow">
                                <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Send Custom API Request</h6></div>
                                <div class="card-body">
                                     <div class="row">
                                        <div class="col-md-3 mb-3"><label for="apiMethod" class="form-label">Method:</label><select id="apiMethod" class="form-select"><option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option><option>PATCH</option><option>OPTIONS</option></select></div>
                                        <div class="col-md-9 mb-3"><label for="apiEndpoint" class="form-label">Endpoint Path:</label><input type="text" id="apiEndpoint" class="form-control" placeholder="/api/some/path/or/full/url"></div>
                                    </div>
                                     <div class="mb-3"><label for="apiBody" class="form-label">Request Body (JSON):</label><textarea id="apiBody" class="form-control" rows="6" placeholder='{"key": "value"}'></textarea></div>
                                     <button class="btn btn-secondary w-100" onclick="sendApiRequest()"><i class="bi bi-send"></i> Send API Request</button>
                                     <div id="apiResult" class="result mt-3">API Explorer results...</div>
                                </div>
                            </div>
                        </div><!-- /#api-explorer -->

                         <!-- Logs Tab Placeholder -->
                         <!-- <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="v-pills-logs-tab"> ... </div> -->

                    </div> <!-- /#v-pills-tabContent -->
                </div> <!-- /.container-fluid -->
            </div><!-- /#main-content -->

             <!-- Footer -->
            <footer class="sticky-footer bg-white mt-auto">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto py-3">
                        <span class="small">Copyright © SwanStudios Debug Dashboard 2025</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div><!-- /#content-wrapper -->
    </div><!-- /#wrapper -->

    <!-- Sidebar Toggle Button -->
    <div id="sidebarToggle" onclick="toggleSidebar()">
        <i class="bi bi-chevron-left" id="sidebar-toggle-icon"></i>
    </div>

    <!-- Toast Container for Notifications -->
     <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Custom JS -->
    <script>
        // --- Core Request Logic ---
        const API_BASE = ''; // Use relative paths

        async function makeRequest(endpoint, method = 'GET', data = null, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            if (!resultElement) { console.error("Result element not found:", resultElementId); return; }
            resultElement.innerHTML = `<div class="d-flex align-items-center"><strong class="me-2">Loading...</strong><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>`;
            resultElement.className = 'result'; // Reset class

            if (!endpoint.startsWith('/api') && endpoint !== '/health') {
                 endpoint = `/api${endpoint.startsWith('/') ? endpoint : '/' + endpoint}`;
            }
            const url = `${API_BASE}${endpoint}`;

            const options = { method, headers: { 'Accept': 'application/json' }, credentials: 'include' };
            if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                options.headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(data);
            }

            let responseData = { _rawResponse: null, _errorParsing: null };
            let rStatus=500, rStatusText='Client Error', rOk=false;

            try {
                console.log(`[Debug Page] Request: ${method} ${url}`, data || '');
                const response = await fetch(url, options); // Using standard fetch
                rStatus = response.status; rStatusText = response.statusText; rOk = response.ok;
                const text = await response.text(); responseData._rawResponse = text;
                const cType = response.headers.get('content-type');
                if (text && cType && cType.includes('application/json')) {
                    try { responseData = JSON.parse(text); delete responseData._rawResponse; }
                    catch (e) { responseData = responseData._rawResponse; responseData._errorParsing = e.message; console.warn(`Non-JSON response for ${url}`);}
                } else if (text) { responseData = responseData._rawResponse; }
                else { responseData = "[Empty Body]"; }

                const result = { status: rStatus, statusText: rStatusText, ok: rOk, data: responseData };
                resultElement.textContent = JSON.stringify(result, null, 2);
                resultElement.classList.add(rOk ? 'status-ok' : 'status-error');
                showToast(`${method} ${endpoint.split('/').pop()} -> ${rStatus}`, rOk ? 'success' : 'danger');

            } catch (error) {
                console.error(`[Debug Page] Network Error: ${method} ${url}`, error);
                const result = { error: `Network Error: ${error.message}`, name: error.name, status: rStatus, ok: rOk };
                resultElement.textContent = JSON.stringify(result, null, 2);
                resultElement.classList.add('status-error');
                showToast(`Network Error: ${error.message}`, 'danger');
            }
        }

        // --- Test Functions (Auth & Debug) ---
        function checkUserDebug() { const id = document.getElementById('check-identifier-debug').value; if (!id) return alert('Please enter username or email.'); makeRequest(`/api/debug/check-user/${encodeURIComponent(id)}`, 'GET', null, 'check-user-result-debug'); }
        function verifyPasswordDebug() { const u = document.getElementById('verify-username-debug').value, p = document.getElementById('verify-password-debug').value; if (!u || !p) return alert('Please enter username and password.'); makeRequest('/api/debug/verify-password', 'POST', { username: u, password: p }, 'verify-password-result-debug'); }
        function testLogin() { const u = document.getElementById('login-username').value, p = document.getElementById('login-password').value; if (!u || !p) return alert('Please enter login username and password.'); makeRequest('/api/auth/login', 'POST', { username: u, password: p }, 'login-result'); }
        function testRegistration() { const u = document.getElementById('reg-username').value, e = document.getElementById('reg-email').value, p = document.getElementById('reg-password').value, f = document.getElementById('reg-firstName').value, l = document.getElementById('reg-lastName').value; if (!u||!e||!p||!f||!l) return alert('Please fill all registration fields.'); makeRequest('/api/auth/register', 'POST', { username:u, email:e, password:p, firstName:f, lastName:l }, 'registration-result'); }
        // --- Test Functions (Store, Cart, Checkout) ---
        function viewCart() { const uid = document.getElementById('cart-user-id').value; if (!uid) return alert('Please enter User ID.'); makeRequest(`/api/cart/user/${uid}`, 'GET', null, 'view-cart-result'); }
        function addToCart() { const uid = document.getElementById('cart-user-id').value, iid = document.getElementById('cart-item-id').value, q = parseInt(document.getElementById('cart-quantity').value, 10); if (!uid||!iid||isNaN(q)||q<1) return alert('Please enter User ID, Storefront Item ID, and valid Quantity > 0.'); makeRequest('/api/cart/add', 'POST', { userId: parseInt(uid), itemId: parseInt(iid), quantity: q }, 'cart-op-result'); }
        function updateCartItem() { const cid = document.getElementById('cart-item-update-id').value, q = parseInt(document.getElementById('cart-update-quantity').value, 10); if (!cid||isNaN(q)||q<0) return alert('Please enter Cart Item ID (from View Cart) and valid Quantity >= 0.'); makeRequest(`/api/cart/item/${cid}`, 'PUT', { quantity: q }, 'cart-op-result'); }
         function removeFromCart() { const cid = document.getElementById('cart-item-update-id').value; if (!cid) return alert('Please enter Cart Item ID (from View Cart) to remove.'); makeRequest(`/api/cart/item/${cid}`, 'DELETE', null, 'cart-op-result'); }
        function startCheckout() { const uid = document.getElementById('checkout-user-id').value; if (!uid) return alert('Please enter User ID for checkout.'); makeRequest('/api/checkout/create-session', 'POST', { userId: parseInt(uid) }, 'checkout-result'); }
        // --- Test Functions (Sessions/Schedule) ---
        function viewSchedule() { const uid = document.getElementById('schedule-user-id').value; if (!uid) return alert('Please enter User ID.'); makeRequest(`/api/schedule/user/${uid}`, 'GET', null, 'session-result'); }
        function viewSessionDetails() { const sid = document.getElementById('session-id').value; if (!sid) return alert('Please enter Session ID.'); makeRequest(`/api/schedule/session/${sid}`, 'GET', null, 'session-result'); }
        // --- API Explorer ---
         function sendApiRequest() { const m = document.getElementById('apiMethod').value, e = document.getElementById('apiEndpoint').value; let d = null; if (!e) return alert('Please enter an API Endpoint path.'); if (m==='POST'||m==='PUT'||m==='PATCH') { try { d = JSON.parse(document.getElementById('apiBody').value || '{}'); } catch (err) { alert('Invalid JSON in Request Body: ' + err.message); return; } } const endpointPath = e.startsWith('/') ? e : `/${e}`; makeRequest(endpointPath, m, d, 'apiResult'); }

        // --- UI Helpers ---
        function toggleSidebar() { document.body.classList.toggle('sidebar-toggled'); const icon = document.getElementById('sidebar-toggle-icon'); icon.className = document.body.classList.contains('sidebar-toggled') ? 'bi bi-chevron-right' : 'bi bi-chevron-left'; }
        function navigateToTab(tabId) { const el = document.querySelector(`.nav-link[href="#${tabId}"]`); if (el) bootstrap.Tab.getOrCreateInstance(el).show(); }
        function showToast(message, type = 'info') { const container = document.querySelector('.toast-container'); if (!container) return; let bg = 'bg-secondary'; if (type === 'success') bg = 'bg-success'; else if (type === 'danger') bg = 'bg-danger'; else if (type === 'warning') bg = 'bg-warning text-dark'; else if (type === 'info') bg = 'bg-info'; const id = 'toast-' + Date.now(); const html = `<div id="${id}" class="toast align-items-center text-white ${bg} border-0" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div></div>`; container.insertAdjacentHTML('beforeend', html); const el = document.getElementById(id); const instance = new bootstrap.Toast(el, { delay: 5000 }); instance.show(); el.addEventListener('hidden.bs.toast', () => el.remove()); }
        function updateTime() { const el = document.getElementById('current-time'); if(el) el.textContent = new Date().toLocaleTimeString(); }
        async function checkSystemStatus() { /* Keep existing checkSystemStatus logic */ 
            try {
                 const res = await fetch('/health'); const data = await res.json();
                 document.getElementById('environment-value').textContent = data.environment || 'N/A';
                 document.getElementById('environment-value-card').textContent = data.environment || 'N/A';
                 document.getElementById('version-value').textContent = data.server?.nodeVersion || 'N/A';
                 const dbBadge = document.getElementById('database-status');
                 const dbCard = document.getElementById('db-status-card');
                 dbBadge.textContent = data.database === 'connected' ? 'Connected' : 'Error';
                 dbBadge.className = `connection-badge ${data.database === 'connected' ? 'connected' : 'disconnected'}`;
                 dbCard.textContent = data.database === 'connected' ? 'Connected' : 'Error';
                 const uptime = data.server?.uptime || 0; const hours = Math.floor(uptime / 3600); const minutes = Math.floor((uptime % 3600) / 60); const seconds = Math.floor(uptime % 60);
                 document.getElementById('server-uptime').textContent = `${hours}h ${minutes}m ${seconds}s`;
                 const mem = data.server?.memoryUsage; const heapUsed = mem ? Math.round(mem.heapUsed / 1024 / 1024) : 0;
                 document.getElementById('memory-usage').textContent = `${heapUsed} MB Used`;
             } catch(e) { console.error("Health check failed", e); document.getElementById('database-status').textContent = 'Error'; document.getElementById('database-status').className = 'connection-badge disconnected'; document.getElementById('db-status-card').textContent = 'Error'; showToast('Failed to fetch system status.', 'danger');}
        }
        function runSystemCheck() { /* Keep existing runSystemCheck logic */ 
            const diagnosticsContainer = document.getElementById('diagnostics-results'); diagnosticsContainer.textContent = 'Running system diagnostics...';
            Promise.allSettled([ makeRequest('/health','GET',null,'diag-health'), makeRequest('/api/debug/check-db','GET',null,'diag-db'), makeRequest('/api/debug/auth-check','GET',null,'diag-auth') ])
            .then(() => {
                const healthRes = JSON.parse(document.getElementById('diag-health').textContent || '{}');
                const dbRes = JSON.parse(document.getElementById('diag-db').textContent || '{}');
                const authRes = JSON.parse(document.getElementById('diag-auth').textContent || '{}');
                diagnosticsContainer.innerHTML = `
                    <div class="test-case ${healthRes.ok && healthRes.data?.database === 'connected' ? 'success' : 'error'}"><strong>DB Connection:</strong> ${healthRes.data?.database || healthRes.error || 'Error'}</div>
                    <div class="test-case ${authRes.ok && authRes.data?.success ? 'success' : 'error'}"><strong>Auth Routes Check:</strong> ${authRes.ok && authRes.data?.success ? 'OK' : authRes.data?.message || authRes.error || 'Error'}</div>
                    <div class="test-case success"><strong>Basic Endpoint Checks:</strong> Completed</div>`;
                 // Clean up hidden results
                 document.getElementById('diag-health').textContent = ''; document.getElementById('diag-db').textContent = ''; document.getElementById('diag-auth').textContent = '';
                 showToast('System diagnostics completed', 'success');
            });
         }

        // --- Initial Load ---
         document.addEventListener('DOMContentLoaded', () => {
             const triggerTabList = document.querySelectorAll('#v-pills-tab a');
             triggerTabList.forEach(triggerEl => { bootstrap.Tab.getOrCreateInstance(triggerEl); triggerEl.addEventListener('click', event => { event.preventDefault(); bootstrap.Tab.getInstance(triggerEl).show(); }); });
             const firstTab = document.querySelector('#v-pills-tab a'); if(firstTab) bootstrap.Tab.getOrCreateInstance(firstTab).show();
             setInterval(updateTime, 1000); updateTime();
             checkSystemStatus(); setInterval(checkSystemStatus, 30000);
         });
    </script>
    <!-- Hidden divs for system check results -->
    <div id="diag-health" style="display: none;"></div>
    <div id="diag-db" style="display: none;"></div>
    <div id="diag-auth" style="display: none;"></div>
</body>
</html>
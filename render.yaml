# SwanStudios Render Deployment Configuration
# ==========================================
# Complete configuration for deploying SwanStudios to Render with PostgreSQL

# Main web service (Node.js backend + frontend)
services:
  - type: web
    name: swanstudios-main
    runtime: node
    repo: https://github.com/YOUR-USERNAME/SS-PT # Update with your repo
    branch: main
    rootDir: ./
    buildCommand: |
      # Install backend dependencies
      cd backend && npm install
      # Install frontend dependencies and build
      cd ../frontend && npm install && npm run build
    startCommand: cd backend && npm start
    plan: starter # or standard/pro based on needs
    env:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: FRONTEND_URL
        value: https://swanstudios-frontend.onrender.com
      - key: FRONTEND_ORIGINS
        value: https://swanstudios-frontend.onrender.com,https://sswanstudios.com,https://www.sswanstudios.com
      - key: DATABASE_URL
        fromDatabase:
          name: swanstudios-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
        length: 32
      - key: STRIPE_SECRET_KEY
        sync: false  # Set manually in Render dashboard
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false  # Set manually in Render dashboard
      - key: REDIS_URL
        fromService:
          type: redis
          name: swanstudios-redis
          property: connectionString
      - key: USE_REDIS_SESSIONS
        value: true
      - key: SESSION_SECRET
        generateValue: true
        length: 32

  # Frontend static site (PRODUCTION CONFIGURATION)
  - type: static
    name: swanstudios-frontend
    runtime: node
    repo: https://github.com/SeanSwan/-SS-PT-New
    branch: main
    rootDir: ./frontend
    buildCommand: rm -rf node_modules/.vite && npm install && npm run build
    staticPublishPath: ./dist
    routes:
      # SPA routing - serve index.html for all non-file routes
      - type: rewrite
        source: /*
        destination: /index.html
    env:
      - key: VITE_API_URL
        value: https://ss-pt-new.onrender.com
      - key: VITE_API_BASE_URL
        value: https://ss-pt-new.onrender.com
      - key: VITE_BACKEND_URL
        value: https://ss-pt-new.onrender.com
      - key: NODE_ENV
        value: production

  # MCP Servers â€” DECOMMISSIONED 2026-02-12
  # External Python MCP servers are no longer deployed.
  # All features migrated to in-app implementations.
  # See docs/ai-workflow/launch-readiness/MCP-DECOMMISSION-PLAN.md

# PostgreSQL database
databases:
  - name: swanstudios-db
    databaseName: swanstudios
    user: swanstudios_user
    plan: starter # or standard/pro based on needs

  # Redis for session storage (multi-instance scaling)
  - name: swanstudios-redis
    plan: starter # or standard/pro based on needs
    maxmemoryPolicy: allkeys-lru # Automatically evict old keys when memory limit reached
    ipAllowList: [] # Empty means allow from all Render services

# Environment variables to set manually in Render dashboard:
# - STRIPE_SECRET_KEY: Your Stripe secret key
# - STRIPE_PUBLISHABLE_KEY: Your Stripe publishable key
# - EMAIL_SERVICE_API_KEY: If using email service
# - Any other third-party API keys

# Custom domains (optional)
# domains:
#   - name: app.swanstudios.com
#     type: apex
#   - name: api.swanstudios.com
#     type: subdomain
